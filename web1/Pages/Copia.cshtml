@page
@model web1.Pages.CopiaModel
@{
    Layout = "_Layoutcopia";
    ViewData["Title"] = "Tareas (JSON) con filtros";
}

<h2>Lista de Tareas (desde JSON)</h2>

<!--los estados-->
<p>
    <strong>Estados:</strong>
    <span style="background:#eee; padding:3px 6px; border-radius:4px; margin-right:6px;">
        Pendientes: @Model.CntPendientes
    </span>
    <span style="background:#eee; padding:3px 6px; border-radius:4px; margin-right:6px;">
        En curso: @Model.CntEnCurso
    </span>
    <span style="background:#eee; padding:3px 6px; border-radius:4px;">
        Finalizados: @Model.CntFinalizados
    </span>
</p>

<!-- Filtros y tamaño de página -->
<form method="get">
    <label>Estado: </label>
    <select name="FiltroEstado">
        <option value="todos" selected="@(Model.FiltroEstado?.ToLower() == "todos")">Todos</option>
        <option value="pendientes" selected="@(Model.FiltroEstado?.ToLower() == "pendientes")">Pendientes</option>
        <option value="en-curso" selected="@(Model.FiltroEstado?.ToLower() == "en-curso")">En curso</option>
        <option value="finalizados" selected="@(Model.FiltroEstado?.ToLower() == "finalizados")">Finalizados</option>
    </select>

    <label style="margin-left:10px;">Tamaño de página: </label>
    <select name="Tamano">
        <option value="5" selected="@(Model.Tamano == 5)">5</option>
        <option value="6" selected="@(Model.Tamano == 6)">6</option>
        <option value="7" selected="@(Model.Tamano == 7)">7</option>
        <option value="8" selected="@(Model.Tamano == 8)">8</option>
        <option value="9" selected="@(Model.Tamano == 9)">9</option>
        <option value="10" selected="@(Model.Tamano == 10)">10</option>
    </select>


    <button type="submit">Aplicar</button>
</form>

<hr />

@if (Model.Tareas.Count == 0)
{
    <p>No hay tareas para mostrar.</p>
}
else
{
    <table border="1" cellpadding="6">
        <tr>
            <th>Tarea</th>
            <th>Fecha de vencimiento</th>
            <th>Estado</th>
        </tr>
        @foreach (var t in Model.Tareas)
        {
            <tr>
                <td>@t.NombreTarea</td>
                <td>@t.FechaVencimiento</td>
                <td>@t.Estado</td>
            </tr>
        }
    </table>

    <!-- Paginación: conserva filtro y tamaño -->
    <div style="margin-top:10px;">
        @if (Model.Pagina > 1)
        {
            <a asp-page="./Copia"
               asp-route-Pagina="@(Model.Pagina - 1)"
               asp-route-Tamano="@Model.Tamano"
               asp-route-FiltroEstado="@Model.FiltroEstado">« Anterior</a>
        }

        <span style="margin:0 8px;">
            Página @Model.Pagina de @Model.TotalPaginas
            (total @Model.TotalRegistros)
        </span>

        @if (Model.Pagina < Model.TotalPaginas)
        {
            <a asp-page="./Copia"
               asp-route-Pagina="@(Model.Pagina + 1)"
               asp-route-Tamano="@Model.Tamano"
               asp-route-FiltroEstado="@Model.FiltroEstado">Siguiente »</a>
        }
    </div>
}
